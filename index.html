<!DOCTYPE html>
<html lang="zh-TW">
<!-- [前面的 head 和 style 部分保持不變] -->

<script>
    // 修改 generateBookmarkCode 函數
    function generateBookmarkCode(data) {
        const code = `javascript:(function(){
            const adData = ${JSON.stringify(data)};
            
            // 添加樣式
            const style = document.createElement('style');
            style.textContent = '.ad-replacer-modal{position:fixed;top:20px;left:50%;transform:translateX(-50%);background:white;padding:20px;border-radius:8px;box-shadow:0 2px 10px rgba(0,0,0,0.2);z-index:999999;width:320px;font-family:Arial,sans-serif}';
            document.head.appendChild(style);
            
            // 開始替換廣告
            let replacedCount = 0;
            adData.forEach(item => {
                const selectors = [
                    'ins.adsbygoogle',
                    'div[id^="google_ads_iframe"]',
                    'div[id^="div-gpt-ad"]',
                    'div[data-ad-client]',
                    'div[class*="gpt-ad"]',
                    'iframe[id^="google_ads_iframe"]',
                    'div[class*="adsky"]'
                ];
                
                selectors.forEach(selector => {
                    document.querySelectorAll(selector).forEach(ad => {
                        const [width, height] = item.size.split('x').map(Number);
                        
                        if (ad.offsetWidth === width && ad.offsetHeight === height) {
                            const adContainer = ad.tagName === 'IFRAME' ? ad.parentElement : ad;
                            adContainer.innerHTML = '';
                            adContainer.style.width = width + 'px';
                            adContainer.style.height = height + 'px';
                            adContainer.style.overflow = 'hidden';
                            adContainer.style.position = 'relative';
                            
                            if (width === 300 && height === 250) {
                                adContainer.innerHTML = \`
                                    <div style="width:300px;height:157px;overflow:hidden">
                                        <img src="\${item.imageUrl}" style="width:300px;height:157px;display:block">
                                    </div>
                                    <div style="height:93px;padding:12px 25px 0 25px;position:relative">
                                        <div style="font-size:18px;line-height:1.5;font-weight:bold;height:54px;overflow:hidden">\${item.title}</div>
                                        <div style="font-size:9px;color:#999999;position:absolute;bottom:15px;left:25px">\${item.brand}</div>
                                        <div style="position:absolute;bottom:15px;right:25px;background:#4397F1;color:white;font-size:10px;padding:3px 8px;border-radius:4px;font-weight:bold">開啟</div>
                                    </div>
                                \`;
                            } else if (width === 970 && height === 250) {
                                adContainer.style.display = 'flex';
                                adContainer.innerHTML = \`
                                    <div style="width:478px;height:250px;overflow:hidden">
                                        <img src="\${item.imageUrl}" style="width:478px;height:250px;display:block">
                                    </div>
                                    <div style="width:492px;height:250px;padding:20px 25px;position:relative;box-sizing:border-box">
                                        <div style="font-size:26px;line-height:1.8;font-weight:bold;color:#666666;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden">\${item.title}</div>
                                        <div style="font-size:13px;color:#999999;position:absolute;bottom:20px;left:25px">\${item.brand}</div>
                                        <div style="position:absolute;bottom:20px;right:25px;background:#4397F1;color:white;font-size:14px;padding:4px 10px;border-radius:4px;font-weight:bold">開啟</div>
                                    </div>
                                \`;
                            }
                            replacedCount++;
                        }
                    });
                });
            });
            
            alert(\`已替換 \${replacedCount} 個廣告位\`);
            style.remove();
        })();`;
        
        document.getElementById('bookmarkCode').textContent = code;
        document.getElementById('codeArea').classList.remove('hidden');
    }
</script>
<!-- [其餘部分保持不變] -->
</html>
